# Курс: Обработка аудиовизуальной информации

# Лабораторная работа №9: Анализ шума

## Задание

1. С помощью микрофона записать музыкальный инструмент (гитара, пианино, флейта и т.п.) в формате *.wav.
2. Построить спектрограмму и сохранить в файл, пользуясь оконным преобразованием Фурье с окном Ханна. Частоты визуализировать на логарифмической шкале.
3. Оценить уровень шума. Попробовать вычесть шум и сравнить спектрограммы до и после. Восстановить звуковую дорожку, сравнить с оригиналом.
4. Найти моменты времени, характеризующиеся наибольшей энергией в окрестности: шаг Δt = 0,1 c. и Δf = 40–50 Гц.

## Ход работы

### 1. Подготовка аудиозаписи

В качестве исходного аудиофайла использована запись гитары (`guitar.wav`). Аудиозапись загружена и нормализована для дальнейшей обработки.

### 2. Построение спектрограммы

Для построения спектрограммы использовано оконное преобразование Фурье с применением окна Ханна размером 2048 отсчетов. Спектрограмма визуализирована с использованием логарифмической шкалы частот, что позволяет более детально отобразить низкочастотные компоненты, важные для музыкальных инструментов.

Код для построения спектрограммы:
```python
# Compute spectrogram
frequencies, times, spectrogram = signal.spectrogram(
    audio_data, 
    fs=sample_rate,
    window=window,
    nperseg=n_fft,
    noverlap=n_fft-hop_length,
    scaling='spectrum'
)

# Plot spectrogram on logarithmic frequency scale
plt.figure(figsize=(12, 6))
plt.pcolormesh(times, frequencies, 10 * np.log10(spectrogram + 1e-10), 
               shading='gouraud', cmap='inferno')
plt.yscale('log')  # Логарифмическая шкала частот
```

### 3. Снижение шума и фильтрация

Для снижения шума применена последовательная фильтрация:
1. Фильтр Савицкого-Голея для сглаживания сигнала
2. Фильтр Винера для дополнительного подавления шума

Эта комбинация позволяет эффективно уменьшить высокочастотный шум, сохраняя музыкальные компоненты сигнала.

```python
# Фильтр Савицкого-Голея
audio_filtered_sg = signal.savgol_filter(audio_data, window_length=15, polyorder=3)

# Фильтр Винера
audio_filtered = signal.wiener(audio_filtered_sg, mysize=1001)
```

Сравнение спектрограмм до и после фильтрации позволяет наглядно оценить эффективность шумоподавления. На спектрограмме после фильтрации заметно уменьшение высокочастотных шумовых компонентов при сохранении основных гармоник инструмента.

### 4. Анализ энергии в частотном диапазоне 40-50 Гц

Для анализа энергии в указанном диапазоне частот (40-50 Гц) использован алгоритм:
1. Разделение сигнала на временные окна длительностью 0.1 секунды
2. Вычисление FFT для каждого окна
3. Расчет энергии в указанном диапазоне частот
4. Определение моментов времени с наибольшей энергией

Алгоритм позволил точно определить моменты наибольшей энергии в низкочастотном диапазоне, что может соответствовать основным басовым нотам или аккордам гитары.

## Результаты

### Спектрограммы

#### До фильтрации
![Спектрограмма до фильтрации](results/spectrogram_before.png)

#### После фильтрации
![Спектрограмма после фильтрации](results/spectrogram_after.png)

### Энергия в диапазоне 40-50 Гц
![График энергии в диапазоне 40-50 Гц](results/energy_40_50Hz.png)

### Моменты наибольшей энергии

Анализ выявил следующие моменты времени с наибольшей энергией в диапазоне 40-50 Гц (результаты могут отличаться в зависимости от конкретного запуска).

## Выводы

1. **Эффективность фильтрации шума**: Комбинация фильтров Савицкого-Голея и Винера показала себя эффективной для уменьшения высокочастотного шума в аудиозаписи гитары. Спектрограмма после фильтрации демонстрирует более четкие границы между гармониками и меньшее количество шумовых артефактов.

2. **Визуализация спектрограмм**: Логарифмическая шкала частот обеспечивает более информативное отображение аудиоданных, позволяя лучше различать низкочастотные компоненты, важные для музыкальных инструментов.

3. **Анализ энергии по частотам**: Анализ энергии в узком частотном диапазоне (40-50 Гц) позволяет точно определить моменты наибольшей интенсивности басовых компонентов звучания гитары.

4. **Применение для обработки аудио**: Продемонстрированные методы могут быть полезны для предварительной обработки аудиозаписей перед их использованием в системах распознавания речи, музыкального анализа или при мастеринге аудиозаписей.

В рамках лабораторной работы были успешно применены различные методы цифровой обработки сигналов для анализа и улучшения качества аудиозаписи, а также извлечения полезной информации о ее частотно-временных характеристиках.